(this.webpackJsonpcboard=this.webpackJsonpcboard||[]).push([[3],{2405:function(e,t,n){"use strict";n.r(t),n.d(t,"getDataUri",(function(){return M})),n.d(t,"openboardExportAdapter",(function(){return z})),n.d(t,"openboardExportOneAdapter",(function(){return T})),n.d(t,"openboardExportManyAdapter",(function(){return G})),n.d(t,"cboardExportAdapter",(function(){return q})),n.d(t,"pdfExportAdapter",(function(){return X}));var r=n(1),a=n(3),o=n.n(a),i=n(13),c=n(81),s=n(2393),u=n.n(s),l=n(286),d=n.n(l),p=n(158),f=n.n(p),h=n(2394),b=n.n(h),g=n(2395),m=n.n(g),v=n(2396),y=n(586),w=n(49),x=n(16),k=n(187),O=n(288),j=n(2397),A=n.n(j),C=n(2400),E=n.n(C);b.a.vfs=m.a.pdfMake.vfs;var S=new Image;function B(e){var t=e.replace(/([A-Z])/g,(function(e){return"_"+e.toLowerCase()}));return t.startsWith("_")?t.slice(1):t}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={},r=y.c.filter((function(t){return!!e[t]}));r.forEach((function(t){var r="".concat(y.b).concat(B(t));n[r]=e[t]}));var a=e.label||e.labelKey||"";return n.label=a.length?t.formatMessage({id:a}):a,e.action&&(n.action=e.action),e.vocalization&&(n.vocalization=e.vocalization),e.borderColor&&(n.border_color=e.borderColor),e.backgroundColor&&(n.background_color=e.backgroundColor),n}function W(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(","),n=Object(c.a)(t,2),r=n[0],a=n[1],o=r.split(":")[1].split(";")[0],i=atob(a),s=new ArrayBuffer(i.length),u=new Uint8Array(s),l=0;l<i.length;l++)u[l]=i.charCodeAt(l);return{ab:s,data:e,content_type:o}}function M(e){return P.apply(this,arguments)}function P(){return(P=Object(i.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d()({method:"get",url:t,responseType:"arraybuffer"});case 3:return n=e.sent,r=btoa(new Uint8Array(n.data).reduce((function(e,t){return e+String.fromCharCode(t)}),"")),a=n.headers["content-type"],e.abrupt("return",{ab:n.data,content_type:a,data:"data:".concat(a,";base64,").concat(r)});case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to get image at ".concat(t,"."),e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function D(e){return K.apply(this,arguments)}function K(){return(K=Object(i.a)(o.a.mark((function e(t){var n,a,c,s,u,l,d,p,f,h,b,g,m,v=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:{},a=v.length>2?v[2]:void 0,c=v.length>3?v[3]:void 0,s=c.embed,u=void 0!==s&&s,n.tiles&&!(n.tiles.length<1)){e.next=5;break}return e.abrupt("return",{obf:null,images:null});case 5:return l={},d={},p=new Array(Math.ceil(n.tiles.length/y.a)),f=0,e.next=11,Promise.all(n.tiles.map(function(){var e=Object(i.a)(o.a.mark((function e(i,c){var s,h,b,g,m,v,w;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=c>=(f+1)*y.a?f+1:f,!i){e.next=19;break}if(p[f]?p[f].push(i.id):p[f]=[i.id],s=Object(r.a)({id:i.id},_(i,a)),!i.image||!i.image.length){e.next=17;break}if(!(h=Object(x.d)()&&i.image&&0===i.image.search("/")?".".concat(i.image):i.image).startsWith("data:")){e.next=10;break}e.t0=W(h),e.next=13;break;case 10:return e.next=12,M(h);case 12:e.t0=e.sent;case 13:b=e.t0,g=function(){var e=["custom",n.name||n.nameKey,i.label||i.labelKey||i.id],t=A.a.extension(b.content_type);return"/".concat(O.join(e,"/"),".").concat(t)},m=h.startsWith("data:")?g():Object(x.d)()?"":h.startsWith("/")?h:"/".concat(h),b&&(v=(new E.a.Types.ObjectId).toString(),d[v]=O.defaults({path:m},b),s.image_id=v,l[v]={id:v,path:u?void 0:m,data:u?b.data:void 0,content_type:b.content_type,width:300,height:300});case 17:return i.loadBoard&&t[i.loadBoard]&&(w=t[i.loadBoard],s.load_board={name:w.nameKey?a.formatMessage({id:w.nameKey}):"",path:"boards/".concat(i.loadBoard,".obf")}),e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 11:if(h=e.sent,!(p.length>=1)){e.next=21;break}return(b=y.a-p[p.length-1].length)>0&&(g=new Array(b).map((function(){return null})),p[p.length-1]=p[p.length-1].concat(g)),m={format:"open-board-0.1",id:n.id,locale:a.locale,name:n.name,url:"".concat(y.d.URL).concat(n.id),license:y.d.LICENSE,images:Object.values(l),buttons:h,sounds:[],grid:{rows:p.length,columns:y.a,order:p},description_html:n.nameKey?a.formatMessage({id:n.nameKey}):""},y.c.filter((function(e){return"undefined"!==typeof n[e]})).forEach((function(e){var t="".concat(y.b).concat(B(e));m[t]=n[e]})),e.abrupt("return",{obf:m,images:d});case 21:return e.abrupt("return",{obf:null,images:null});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){var n=e.label||e.labelKey||"";return{label:n.length?t.formatMessage({id:n}):n,image:e.image||""}}function U(e){return J.apply(this,arguments)}function J(){return(J=Object(i.a)(o.a.mark((function e(t){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=a.length>2&&void 0!==a[2]?a[2]:"image/jpeg",e.abrupt("return",new Promise((function(e,a){S.crossOrigin="Anonymous",S.onload=function(){var t=document.createElement("CANVAS"),a=t.getContext("2d"),o=n.backgroundColor||"white",i=n.borderColor||null;t.height=150,t.width=150,a.fillStyle=o,a.fillRect(0,0,t.width,t.height),i&&(a.strokeStyle=i,a.lineWidth=2,a.strokeRect(0,0,t.width,t.height));var c=1,s=1;(this.naturalWidth>150||this.naturalHeight>150)&&(c=150/this.naturalWidth,s=150/this.naturalHeight),a.drawImage(this,0,0,this.naturalWidth*c,this.naturalHeight*s),i&&(a.strokeStyle=i,a.lineWidth=3,a.strokeRect(0,0,150,150));var u=t.toDataURL(r);e(u)},S.onerror=function(){a(new Error("Getting remote image failed"))};var o=Object(x.d)()&&t&&0===t.search("/")?".".concat(t):t;S.src=t?o:y.g,(S.complete||void 0===S.complete)&&(S.src=t?o:y.g)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return N.apply(this,arguments)}function N(){return(N=Object(i.a)(o.a.mark((function e(t,n){var r,a,c,s,u,l,d,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(p.length>2&&void 0!==p[2])||p[2],a=t.name||"",c={table:{widths:"16%",body:[{}]},layout:"noBorders"},r&&(c.pageBreak="after"),t.tiles&&t.tiles.length){e.next=6;break}return e.abrupt("return",[a,c]);case 6:return s=new Array(2*Math.ceil(t.tiles.length/y.a)),u=0,e.next=10,t.tiles.reduce(function(){var e=Object(i.a)(o.a.mark((function e(t,r,a){var i,c,l,d,p,f,h,b,g,m,v,x;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(i=R(r,n),c=i.label,l=i.image,u=a>=(u+1)*y.a?u+1:u,d=2*u,p="",f=l,l.startsWith("data:")&&!l.startsWith("data:image/svg+xml")){e.next=22;break}return h=l,b={},r.backgroundColor&&(b.backgroundColor=r.backgroundColor),r.borderColor&&(b.borderColor=r.borderColor),e.prev=12,e.next=15,U(h,b);case 15:f=e.sent,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(12),console.log(e.t0.message),f=y.i;case 22:return p={image:f,alignment:"center",width:"100"},g={text:c,alignment:"center"},m=H(),x={},m.labelPosition&&m.labelPosition===w.f?(v=p,x=g):m.labelPosition&&m.labelPosition===w.e?(x=p,v=g):(v={text:" "},x=p),(u+1)%y.e===0&&(x.pageBreak="after"),s[d]?(s[d].push(v),s[d+1].push(x)):(s[d]=[v],s[d+1]=[x]),e.abrupt("return",s);case 30:case"end":return e.stop()}}),e,null,[[12,18]])})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve());case 10:return(l=y.a-s[s.length-2].length)>0&&(d=new Array(l).fill(""),s[s.length-2]=s[s.length-2].concat(d),s[s.length-1]=s[s.length-1].concat(d)),c.table.body=s,e.abrupt("return",[a,c]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=function(){return Object(k.b)().getState().app.displaySettings},Y=function(){return f()().format("YYYY-MM-DD_HH-mm-ss-")};function z(e,t){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.isArray(t)?G(t,n):T(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(o.a.mark((function e(t,n){var r,a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D({[t.id]:t},t,n,{embed:!0});case 2:r=e.sent,a=r.obf,(i=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}))&&(c=Y()+t.name+" ",Object(x.c)()?(Object(x.h)(),Object(x.i)("Download/"+c+"board.obf",i)):Object(v.saveAs)(i,c+"board.obf"));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(){return V.apply(this,arguments)}function V(){return(V=Object(i.a)(o.a.mark((function e(){var t,n,r,a,i,c,s,l,d,p,f,h=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=h.length>0&&void 0!==h[0]?h[0]:[],n=h.length>1?h[1]:void 0,r=t.length,a={},i={},c=new u.a,s=t.reduce((function(e,t){return e[t.id]=t,e}),{}),l=o.a.mark((function e(r){var u,l,d,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t[r],l="boards/".concat(u.id,".obf"),e.next=4,D(s,u,n,{embed:!1});case 4:if(d=e.sent,p=d.obf,f=d.images,p){e.next=9;break}return e.abrupt("return","continue");case 9:c.file(l,JSON.stringify(p,null,2)),Object.keys(f).forEach((function(e){var t=f[e],n="images/".concat(t.path);c.file(n,t.ab),i[e]=n})),a[u.id]=l;case 13:case"end":return e.stop()}}),e)})),d=0;case 9:if(!(d<r)){e.next=17;break}return e.delegateYield(l(d),"t0",11);case 11:if("continue"!==e.t0){e.next=14;break}return e.abrupt("continue",14);case 14:d++,e.next=9;break;case 17:p=a.root?a.root:a[Object.keys(s)[0]],f={format:"open-board-0.1",root:p,paths:{boards:a,images:i}},c.file("manifest.json",JSON.stringify(f,null,2)),c.generateAsync(y.f).then((function(e){if(e){var n=Y();if(1===t.length?n=n+t[0].name+" ":n+="boardsset ",Object(x.c)()){Object(x.h)();var r="Download/"+n+y.h.openboard.filename;Object(x.i)(r,e)}else Object(v.saveAs)(e,n+y.h.openboard.filename)}}));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e,t){for(var n=O.fromPairs(O.map(e,(function(e){return[e.id,e]}))),r=[t],a=[t];!O.isEmpty(r);){var o=r.pop(),i=O.get(n[o],"tiles");O.forEach(i,(function(e){var t=e.loadBoard;t&&!O.includes(a,t)&&(a.push(t),r.push(t))}))}return O.map(a,(function(e){return n[e]}))}function q(){return Q.apply(this,arguments)}function Q(){return(Q=Object(i.a)(o.a.mark((function e(){var t,n,r,a,i,c,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=u.length>0&&void 0!==u[0]?u[0]:[],n=u.length>1?u[1]:void 0,r=n?Z(t,n.id):t,(a=new Blob([JSON.stringify(r)],{type:"text/json;charset=utf-8;"}))&&(i=Y(),1===r.length?i=i+r[0].name+" ":i+="boardsset ",Object(x.c)()&&(Object(x.h)(),c="Download/"+i+y.h.cboard.filename,Object(x.i)(c,a)),navigator.msSaveBlob?navigator.msSaveBlob(a,i+y.h.cboard.filename):((s=document.createElement("a")).href=window.URL.createObjectURL(a),s.setAttribute("download",i+y.h.cboard.filename),document.body.appendChild(s),s.click(),document.body.removeChild(s)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(){return $.apply(this,arguments)}function $(){return($=Object(i.a)(o.a.mark((function e(){var t,n,r,a,c,s,u,l=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:[],n=l.length>1?l[1]:void 0,r={pageSize:"A4",pageOrientation:"landscape",content:[]},a=t.length-1,e.next=6,t.reduce(function(){var e=Object(i.a)(o.a.mark((function e(t,r,i){var c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return c=e.sent,s=i!==a,e.next=6,L(r,n,s);case 6:return u=e.sent,e.abrupt("return",c.concat(u));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve([]));case 6:c=e.sent,r.content=c,(s=b.a.createPdf(r))&&(u=Y(),2===c.length?u=u+c[0]+" ":u+="boardsset ",Object(x.c)()?(Object(x.h)(),s.getBuffer((function(e){var t=new Blob([e],{type:"application/pdf"}),n="Download/"+u+y.h.pdf.filename;Object(x.i)(n,t)}))):s.download(u+y.h.pdf.filename));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default={openboardExportAdapter:z,cboardExportAdapter:q,pdfExportAdapter:X}}}]);
//# sourceMappingURL=3.97009e4f.chunk.js.map